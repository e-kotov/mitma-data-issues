{
  "hash": "707a3544c621167ad4f890b54987fe06",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Invalid Geometries in District Boundaries\"\nfrom: markdown+emoji\ncode-annotations: hover\ndate: \"2024-07-17\"\ndate-modified: \"2024-07-17\"\ncategories:\n    - spatial data\n    - geometry\n    - \"importance: medium\"\nissue-importance: medium\nstatus: \"active\"\n---\n\n\n\n\n---\n\n**Status**: {{< meta status >}}\n\n**Summary**: There are 3 invalid geometries in the census districts boundaries dataset.\n\n**Expected Results**: The dataset should not contain any invalid geometries.\n\n### Steps to Reproduce\n\n1. **Load Data**\n\nLoad libraries and define data files.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\ndistrict_boundaries_data_file <- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/zonificacion_distritos.shp\")\ndistrict_names_file <- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/nombres_distritos.csv\")\n```\n:::\n\n\n\n\nLoad the data and join the district names to the boundaries.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_boundaries <- read_sf(district_boundaries_data_file)\n\ndistrict_names <- read_delim(district_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ndistrict_boundaries <- district_boundaries |>\n    left_join(district_names |> select(ID, name), by = c(\"ID\"))\n```\n:::\n\n\n\n\n\n2. **Identify Invalid Geometries**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_boundaries_invalid <- !st_is_valid(district_boundaries)\n```\n:::\n\n\n\n\n### Results\n\n3. **Number of Invalid Geometries**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(district_boundaries_invalid)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3\n```\n\n\n:::\n:::\n\n\n\n\n4. **Names of Districts with Invalid Geometries**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(district_boundaries[district_boundaries_invalid,] |> st_drop_geometry())\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-28e054b956764d96b999\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-28e054b956764d96b999\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\"],[\"20059\",\"31067_AM\",\"31260_AM\"],[\"OÃ±ati\",\"Carcastillo agregacion de municipios\",\"Valle de Yerri/Deierri agregacion de municipios\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>ID<\\/th>\\n      <th>name<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"ID\",\"targets\":1},{\"name\":\"name\",\"targets\":2}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\n\n### Links to the original files\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here(\"R/901-download-helpers.R\"))\nfiles <- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files <- files |> \n  filter(basename(local_path) %in% basename(c(district_boundaries_data_file, district_names_file)) )\n\n# Create HTML links\nrelevant_files <- relevant_files |> \n  mutate(target_url = paste0(\"<a href='\", target_url, \"' target='_blank'>\", target_url, \"</a>\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-5e4e2061e1e5499f0e1a\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5e4e2061e1e5499f0e1a\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\"],[\"<a href='https://movilidad-opendata.mitma.es/zonificacion/zonificacion_distritos/nombres_distritos.csv' target='_blank'>https://movilidad-opendata.mitma.es/zonificacion/zonificacion_distritos/nombres_distritos.csv<\\/a>\",\"<a href='https://movilidad-opendata.mitma.es/zonificacion/zonificacion_distritos/zonificacion_distritos.shp' target='_blank'>https://movilidad-opendata.mitma.es/zonificacion/zonificacion_distritos/zonificacion_distritos.shp<\\/a>\"],[\"2023-04-19T09:57:02Z\",\"2023-04-19T09:57:02Z\"],[\"csv\",\"shp\"],[null,null],[null,null],[\"data/raw_data/v2/zonificacion/zonificacion_distritos/nombres_distritos.csv\",\"data/raw_data/v2/zonificacion/zonificacion_distritos/zonificacion_distritos.shp\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>target_url<\\/th>\\n      <th>pub_ts<\\/th>\\n      <th>file_extension<\\/th>\\n      <th>data_ym<\\/th>\\n      <th>data_ymd<\\/th>\\n      <th>local_path<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":5,\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"target_url\",\"targets\":1},{\"name\":\"pub_ts\",\"targets\":2},{\"name\":\"file_extension\",\"targets\":3},{\"name\":\"data_ym\",\"targets\":4},{\"name\":\"data_ymd\",\"targets\":5},{\"name\":\"local_path\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[5,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [
      "004-invalid-geoms-districts_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}