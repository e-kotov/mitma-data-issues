{
  "hash": "0c6a3f7d349f2b7783e9d0ef0bbf1fbf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Municipal population CSV missing population counts\"\nfrom: markdown+emoji\ncode-annotations: hover\ndate: \"2024-07-16\"\ndate-modified: \"2024-07-16\"\nissue-importance: low\ncategories:\n    - spatial data\n    - geometry\n    - \"importance: low\"\n---\n\n\n\n\n\n**Summary**: The dataset contains missing population counts for 49 municipalities in the CSV file `poblacion_municipios.csv` in the `zonificacion_municipios` folder. The population data is however available in the `poblacion.csv` file in the `zonificacion` folder, therefore issue importance is relatively low.\n\n**Expected Results**: The population data for all municipalities should be available in the CSV file `poblacion_municipios.csv` in the `zonificacion_municipios` folder.\n\n### Steps to Reproduce\n\n1. **Load Data**\n\nLoad libraries and define data files.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\nmunicipal_boundaries_data_file <- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/zonificacion_municipios.shp\")\nmunicipality_names_file <- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/nombres_municipios.csv\")\nmunicipality_population_file <- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/poblacion_municipios.csv\")\nall_population_file <- here(\"data/raw_data/v2/zonificacion/poblacion.csv\")\n```\n:::\n\n\n\n\nLoad the data and join the municipality names to the boundaries.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmunicipality_boundaries <- read_sf(municipal_boundaries_data_file)\nmunicipality_boundaries_spain_only <- municipality_boundaries |> \n    filter(! grepl(\"FR|PT|externo\", ID) )\n\nmunicipality_names <- read_delim(municipality_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nmunicipality_population <- read_delim(municipality_population_file, col_names = c(\"ID\", \"population\"),\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nall_population <- read_delim(all_population_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nmunicipality_boundaries_spain_only <- municipality_boundaries_spain_only |>\n    left_join(municipality_names |> select(ID, name), by = c(\"ID\")) |> \n    left_join(municipality_population, by = c(\"ID\")) |> \n    left_join(all_population |>\n                  group_by(municipio) |>\n                  summarise(population_all = sum(poblacion, na.rm = TRUE), .groups = \"drop\") |> \n                  rename(ID = municipio),\n              by = c(\"ID\"))\n```\n:::\n\n\n\n\n### Results\n\n2. **Missing population (loaded from the `poblacion_municipios.csv` in `zonificacion_municipios` folder)**\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmunicipality_boundaries_spain_only |>\n    filter(is.na(population)) |>\n    nrow()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 49\n```\n\n\n:::\n:::\n\n\n\n\n\n3. **Population data for municipalities actually available in the `poblacion.csv` in the `zonificacion` **\n\nThere are no missing values.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmunicipality_boundaries_spain_only |>\n    filter(is.na(population_all)) |>\n    nrow()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n\n\n\n\n4. **Names of Municipalities with missing population data**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(municipality_boundaries_spain_only |>\n                  st_drop_geometry() |> \n                  filter(is.na(population))\n                  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-df791f0ac718a3243f33\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-df791f0ac718a3243f33\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\"],[\"34022253049\",\"34024453076\",\"34024453077\",\"34063953072\",\"34070953004\",\"34070953005\",\"34070953006\",\"34070953007\",\"34070953008\",\"34070953009\",\"34070953010\",\"34070953011\",\"34070953012\",\"34070953013\",\"34070953014\",\"34070953015\",\"34070953016\",\"34070953018\",\"34070953020\",\"34070953021\",\"34070953022\",\"34070953023\",\"34070953024\",\"34070953026\",\"34070953027\",\"34070953028\",\"34070953029\",\"34070953031\",\"34070953032\",\"34070953033\",\"34070953034\",\"34070953035\",\"34070953036\",\"34070953039\",\"34070953040\",\"34070953041\",\"34070953042\",\"34070953043\",\"34070953044\",\"34070953045\",\"34070953046\",\"34070953073\",\"34072453051\",\"34072453052\",\"34074053074\",\"34074253075\",\"34081953047\",\"34153153078\",\"34172653056\"],[\"Comunero de Ansó y Hecho\",\"Comunidad de la Pardina del Mercadal\",\"El Franco\",\"Comunidad de Campoo y Cabuérniga\",\"Comunidad de Arauzo de Miel y Huerta del Rey\",\"Comunidad de Los Ausines y Revilla del Campo\",\"Comunidad de Barbadillo de Herreros y Vallejimeno (E.L.M.)\",\"Comunidad de 09076, 09290, 09578, 09606 y 09822\",\"Comunidad de 09076, 09290, 09578 y 09822\",\"Cabeza Alta\",\"Comunidad de 09076, 09150 y 09578\",\"Comunidad de 09076, 09498 y 09578\",\"Comunidad de 09076, 09578, 09606 y 09822\",\"Comunidad de Barbadillo del Pez y Jaramillo de la Fuente\",\"Comunidad de Barbadillo del Pez y Riocavado de la Sierra\",\"Comunidad de Bascuñana y Viloria de Rioja\",\"Monte Revenga\",\"Comunidad de Canicosa de la Sierra y Casarejos\",\"Comunidad de Fuente Carazo\",\"Ledanía de 09162, 09290, 09412 y 09606\",\"Dehesa de San Felices\",\"Comunidad de Cilleruelo de Arriba y Pineda Trasmonte\",\"Comunidad de Covarrubias, Quintanilla del Coco y Retuerta\",\"Comunidad de Gete y Hacinas\",\"Ledanía de Hacinas y Salas de los Infantes\",\"Ledanía de Hacinas, Salas de los Infantes y Villanueva de Carazo\",\"Comunidad de 09314, 09374, 09356 y 09126\",\"Valle de las Venadas\",\"Comunidad de Palacios de la Sierra, Vilviestre del Pinar y San Leonardo de Yagüe\",\"Comunidad de Quintanaortuño y Merindad de Río Ubierna\",\"Comunidad de Quintanar de la Sierra y Vilviestre del Pinar\",\"Comunidad de Revilla del Campo y Torrelara\",\"Ledanía de Castrillo de la Reina, Hacinas y Salas de los Infantes\",\"Comunidad de Tardajos y Las Quintanillas\",\"Comunidad de Tardajos y Rabé de las Calzadas\",\"Comunidad de Tinieblas de la Sierra y San Millán de Lara\",\"Comunidad de Vilviestre del Pinar y Palacios de la Sierra\",\"Comunidad de Villoruebo y Torrelara\",\"Comunidad de Vizcaínos y Jaramillo de la Fuente\",\"Comunidad de Quintanilla del Agua y Tordueles y Puentedura\",\"Comunidad de Merindad de Río Ubierna, Quintanilla Vivar y Sotragero\",\"Monte de la Mata\",\"Comunidad de Castrotierra de la Valduerna\",\"Foncabada\",\"Comunidad de Sepúlveda y Riaza\",\"San Bartolomé\",\"Aldovera\",\"Bardenas Reales\",\"Mancomunidad de Nalda, Sorzano y Viguera\"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>ID<\\/th>\\n      <th>name<\\/th>\\n      <th>population<\\/th>\\n      <th>population_all<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[3,4]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"ID\",\"targets\":1},{\"name\":\"name\",\"targets\":2},{\"name\":\"population\",\"targets\":3},{\"name\":\"population_all\",\"targets\":4}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\n\n### Links to the original files\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here(\"R/901-download-helpers.R\"))\nfiles <- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files <- files |> \n  filter(basename(local_path) %in% basename(c(municipal_boundaries_data_file, municipality_names_file,\n                                              municipality_population_file, all_population_file)) )\n\n# Create HTML links\nrelevant_files <- relevant_files |> \n  mutate(target_url = paste0(\"<a href='\", target_url, \"' target='_blank'>\", target_url, \"</a>\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-ba3458f55cddec9d1272\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ba3458f55cddec9d1272\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\"],[\"<a href='https://movilidad-opendata.mitma.es/zonificacion/zonificacion_municipios/nombres_municipios.csv' target='_blank'>https://movilidad-opendata.mitma.es/zonificacion/zonificacion_municipios/nombres_municipios.csv<\\/a>\",\"<a href='https://movilidad-opendata.mitma.es/zonificacion/zonificacion_municipios/poblacion_municipios.csv' target='_blank'>https://movilidad-opendata.mitma.es/zonificacion/zonificacion_municipios/poblacion_municipios.csv<\\/a>\",\"<a href='https://movilidad-opendata.mitma.es/zonificacion/zonificacion_municipios/zonificacion_municipios.shp' target='_blank'>https://movilidad-opendata.mitma.es/zonificacion/zonificacion_municipios/zonificacion_municipios.shp<\\/a>\",\"<a href='https://movilidad-opendata.mitma.es/zonificacion/poblacion.csv' target='_blank'>https://movilidad-opendata.mitma.es/zonificacion/poblacion.csv<\\/a>\"],[\"2023-04-19T09:57:09Z\",\"2023-04-19T09:57:09Z\",\"2023-04-19T09:57:10Z\",\"2023-04-19T09:57:13Z\"],[\"csv\",\"csv\",\"shp\",\"csv\"],[null,null,null,null],[null,null,null,null],[\"data/raw_data/v2/zonificacion/zonificacion_municipios/nombres_municipios.csv\",\"data/raw_data/v2/zonificacion/zonificacion_municipios/poblacion_municipios.csv\",\"data/raw_data/v2/zonificacion/zonificacion_municipios/zonificacion_municipios.shp\",\"data/raw_data/v2/zonificacion/poblacion.csv\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>target_url<\\/th>\\n      <th>pub_ts<\\/th>\\n      <th>file_extension<\\/th>\\n      <th>data_ym<\\/th>\\n      <th>data_ymd<\\/th>\\n      <th>local_path<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":5,\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"target_url\",\"targets\":1},{\"name\":\"pub_ts\",\"targets\":2},{\"name\":\"file_extension\",\"targets\":3},{\"name\":\"data_ym\",\"targets\":4},{\"name\":\"data_ymd\",\"targets\":5},{\"name\":\"local_path\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[5,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [
      "003-missing-population-data-for-municipalities_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}