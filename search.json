[
  {
    "objectID": "issues/011-v1-tpp-mismatch-zone-ids-in-table-and-spatial-data.html",
    "href": "issues/011-v1-tpp-mismatch-zone-ids-in-table-and-spatial-data.html",
    "title": "Mismatch of zone ids in spatial data and trips per person table for municipal zoning",
    "section": "",
    "text": "Status: ⚠️ active\nImportance: 3 - high\nSummary: The zone IDs in the municipal trips per person data (maestra2-mitma-municipios) are not consistent with the zone IDs in the municipal boundaries data (zonificacion-municipios/municipios_mitma.shp). TODO: list mismatching ids?\nExpected Results: The zone IDs in the municipal trips per person data (maestra2-mitma-municipios) should be consistent with the zone IDs in the municipal boundaries data (zonificacion-municipios/municipios_mitma.shp).\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\ntrips_per_person_file_2020_03_14 &lt;- here(\"data/raw_data_cache/v1/maestra2-mitma-municipios/ficheros-diarios/year=2020/month=3/day=14/maestra_2_mitma_municipio.txt.gz\")\ntrips_per_person_file_2020_10_01 &lt;- here(\"data/raw_data_cache/v1/maestra2-mitma-municipios/ficheros-diarios/year=2020/month=10/day=1/maestra_2_mitma_municipio.txt.gz\")\nmunicipal_boundaries_data_file &lt;- here(\"data/raw_data_cache/v1/zonificacion-municipios/municipios_mitma.shp\")\ndistrict_boundaries_data_file &lt;- here(\"data/raw_data_cache/v1/zonificacion-distritos/distritos_mitma.shp\")\n\nLoad the data.\n\ntrips_per_person_2020_03_14 &lt;- readr::read_delim(trips_per_person_file_2020_03_14, delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\ntrips_per_person_2020_10_01 &lt;- readr::read_delim(trips_per_person_file_2020_10_01, delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\nmunicipal_boundaries &lt;- read_sf(municipal_boundaries_data_file)\ndistrict_boundaries &lt;- read_sf(district_boundaries_data_file)\n\n\nglimpse(trips_per_person_2020_03_14)\n\nRows: 8,744\nColumns: 4\n$ fecha         &lt;dbl&gt; 20200314, 20200314, 20200314, 20200314, 20200314, 202003…\n$ distrito      &lt;chr&gt; \"01001_AM\", \"01001_AM\", \"01001_AM\", \"01001_AM\", \"01002\",…\n$ numero_viajes &lt;chr&gt; \"0\", \"1\", \"2\", \"2+\", \"0\", \"1\", \"2\", \"2+\", \"0\", \"1\", \"2\",…\n$ personas      &lt;dbl&gt; 5498.025, 320.152, 1472.050, 1796.115, 5392.325, 728.374…\n\nglimpse(trips_per_person_2020_10_01)\n\nRows: 8,764\nColumns: 4\n$ fecha         &lt;dbl&gt; 20201001, 20201001, 20201001, 20201001, 20201001, 202010…\n$ distrito      &lt;chr&gt; \"01001_AM\", \"01001_AM\", \"01001_AM\", \"01001_AM\", \"01002\",…\n$ numero_viajes &lt;chr&gt; \"0\", \"1\", \"2\", \"2+\", \"0\", \"1\", \"2\", \"2+\", \"0\", \"1\", \"2\",…\n$ personas      &lt;dbl&gt; 2614.317, 245.434, 2280.543, 3836.331, 3956.197, 497.415…\n\nglimpse(municipal_boundaries)\n\nRows: 2,205\nColumns: 2\n$ ID       &lt;chr&gt; \"16078\", \"07058_AM\", \"36057\", \"38033_AM\", \"06109_AM\", \"32007_…\n$ geometry &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((583277.4 44..., MULTIPOLYGON (((…\n\nglimpse(district_boundaries)\n\nRows: 2,850\nColumns: 2\n$ ID       &lt;chr&gt; \"2408910\", \"22117_AM\", \"2305009\", \"07058_AM\", \"2305006\", \"230…\n$ geometry &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((290940.1 47..., MULTIPOLYGON (((…\n\n\n\n\nResults\n\nNot all zone IDs in the municipal level trips per person dataset can be found in the municipal boundaries dataset.\n\nNot all zone (distrito) IDs in the municipal level trips per person dataset can be found in the municipal boundaries dataset. For example, on 2020-03-14, all IDs do mathc, but on 2020-10-01, 5 IDs mismatch.\n\nsum(!unique(trips_per_person_2020_03_14$distrito) %in% unique(municipal_boundaries$ID))\n\n[1] 0\n\nsum(!unique(trips_per_person_2020_10_01$distrito) %in% unique(municipal_boundaries$ID))\n\n[1] 5\n\n\nHere are the mismatching IDs:\n\nunique(trips_per_person_2020_10_01$distrito)[\n  !unique(trips_per_person_2020_10_01$distrito) %in% unique(municipal_boundaries$ID)\n]\n\n[1] \"04902\" \"28006\" \"28106\" \"28123\" \"28127\"\n\n\nIn the spatial dataset we do not have the IDs above, however we do have similar IDs with extra digits:\n\nmunicipal_boundaries |&gt; filter(ID %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) # these IDs exist\n\nSimple feature collection with 5 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 419573.3 ymin: 4059438 xmax: 530623 ymax: 4493337\nProjected CRS: ETRS89 / UTM zone 30N (N-E)\n# A tibble: 5 × 2\n  ID                                                                    geometry\n* &lt;chr&gt;                                                       &lt;MULTIPOLYGON [m]&gt;\n1 2812301 (((455833.8 4471420, 455908.9 4472066, 456023.8 4472526, 455932.7 447…\n2 0490201 (((510312.5 4064495, 509896.8 4064947, 509553.9 4065352, 509030.9 406…\n3 2810601 (((437139.6 4452138, 437133.4 4451989, 437585.1 4451440, 437385.4 445…\n4 2812701 (((428935.1 4480873, 428572.2 4481050, 428255.8 4481124, 427733.7 448…\n5 2800601 (((446243 4484315, 445604.6 4484363, 445359.4 4484328, 445102.9 44846…\n\nmunicipal_boundaries |&gt; filter(ID %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) # these do not\n\nSimple feature collection with 0 features and 1 field\nBounding box:  xmin: NA ymin: NA xmax: NA ymax: NA\nProjected CRS: ETRS89 / UTM zone 30N (N-E)\n# A tibble: 0 × 2\n# ℹ 2 variables: ID &lt;chr&gt;, geometry &lt;GEOMETRY [m]&gt;\n\n\nIt seems like at some point in time in this dataset, the IDs have changed, as we cannot find the same IDs in the data for different dates, as seen below:\n\ntrips_per_person_2020_03_14 |&gt; filter(distrito %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow()\n\n[1] 20\n\ntrips_per_person_2020_03_14 |&gt; filter(distrito %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow()\n\n[1] 0\n\n\n\ntrips_per_person_2020_10_01 |&gt; filter(distrito %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow()\n\n[1] 0\n\ntrips_per_person_2020_10_01 |&gt; filter(distrito %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow()\n\n[1] 20\n\n\nThe longer IDs are not expected to be in the spatial data for municipalities, but they are there, as seen below:\n\nmunicipal_boundaries |&gt; filter(ID %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow() # these IDs exist\n\n[1] 5\n\nmunicipal_boundaries |&gt; filter(ID %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow() # these do not\n\n[1] 0\n\n\nWhat makes the matters more complicated, is that these longer IDs also can be found in the district boundaries, as seen below:\n\ndistrict_boundaries |&gt; filter(ID %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow() # these IDs exist\n\n[1] 5\n\ndistrict_boundaries |&gt; filter(ID %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow() # these do not\n\n[1] 0\n\n\nThrefore it is unclear with which spatial data the trip counts in the trips per person data for municipalities is actually associated.\nLet’s filter the spatial data for both districts and municipalities to only include these IDs and compare them visually.\n\nmunicipal_boundaries_subset &lt;- municipal_boundaries |&gt; filter(ID %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\"))\ndistrict_boundaries_subset &lt;- district_boundaries |&gt; filter(ID %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\"))\n\n\nggplot()+\n  geom_sf(data = municipal_boundaries_subset, fill = \"grey50\", col = NA) +\n  geom_sf(data = district_boundaries_subset, fill = NA, col = \"blue\")\n\n\n\n\n\n\n\n\nThese seem to match perfectly, therefore they can probably be assumed to be the same.\n\n\nIs there such an issue with the district level data?\n\ntrips_per_person_2020_03_14_distr &lt;- readr::read_delim(\n  here(\"data/raw_data_cache/v1/maestra2-mitma-distritos/ficheros-diarios/year=2020/month=3/day=14/maestra_2_mitma_distrito.txt.gz\"),\n  delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\ntrips_per_person_2020_10_01_distr &lt;- readr::read_delim(\n  here(\"data/raw_data_cache/v1/maestra2-mitma-distritos/ficheros-diarios/year=2020/month=10/day=1/maestra_2_mitma_distrito.txt.gz\"),\n  delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\n\ntrips_per_person_2020_03_14_distr |&gt; filter(distrito %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow()\n\n[1] 20\n\ntrips_per_person_2020_03_14_distr |&gt; filter(distrito %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow()\n\n[1] 0\n\ntrips_per_person_2020_10_01_distr |&gt; filter(distrito %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow()\n\n[1] 20\n\ntrips_per_person_2020_10_01_distr |&gt; filter(distrito %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow()\n\n[1] 0\n\n\nNo such issue, the data for districts seem to be consistent.\n\n\nIs there such an issue with the origin-destination data?\n\nod_municip_2020_03_14 &lt;- readr::read_delim(\n  here(\"data/raw_data_cache/v1/maestra1-mitma-municipios/ficheros-diarios/year=2020/month=3/day=14/maestra_1_mitma_municipio.txt.gz\"),\n  delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\n\nod_municip_2020_10_01 &lt;- readr::read_delim(\n  here(\"data/raw_data_cache/v1/maestra1-mitma-municipios/ficheros-diarios/year=2020/month=10/day=1/maestra_1_mitma_municipio.txt.gz\"),\n  delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\n\nod_municip_2020_03_14 |&gt; filter(origen %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow()\n\n[1] 5900\n\nod_municip_2020_03_14 |&gt; filter(origen %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow()\n\n[1] 0\n\nod_municip_2020_03_14 |&gt; filter(destino %in% c(\"0490201\", \"2800601\", \"2810601\", \"2812301\", \"2812701\")) |&gt; nrow()\n\n[1] 5874\n\nod_municip_2020_03_14 |&gt; filter(destino %in% c(\"04902\", \"28006\", \"28106\", \"28123\", \"28127\")) |&gt; nrow()\n\n[1] 0\n\n\nThe data for origin-destination seem to be consistent.\n\n\nConclusion and how the issue should be fixed\nThe zone IDs in the tables for municipal level trips per person data and spatial data do not match starting with a certain date. The zones with IDs “0490201”, “2800601”, “2810601”, “2812301”, “2812701” should be recoded to “04902”, “28006”, “28106”, “28123”, “28127” during the import process of the trips per person tables. This can be easily done using the existing approach of SQL-based view creation in the {spanishoddata} R package.\n\n\nLinks to the original files\n\nfiles &lt;- spanishoddata:::spod_available_data(1, data_dir = here(\"data\"))\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter((local_path %in% c(\n    trips_per_person_file_2020_03_14,\n    trips_per_person_file_2020_10_01)) |\n    grepl(\"zonificacion\", local_path)\n  )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/005-invalid-geoms-gau.html",
    "href": "issues/005-invalid-geoms-gau.html",
    "title": "Invalid Geometries in Large Urban Areas Boundaries",
    "section": "",
    "text": "Status: ✅ resolved\nImportance: 2 - medium\nSummary: There are 3 invalid geometries in the Large Urban Areas boundaries dataset.\nExpected Results: The dataset should not contain any invalid geometries.\n\nResolution: resolved with https://github.com/Robinlovelace/spanishoddata/pull/25 in {spanishoddata} R package.\nTo get valid spatial data, use spanishoddata::spod_get_zones()\n\ninstall.packages(\"spanishoddata\",\n  repos = c(\"https://e-kotov.r-universe.dev\", \"https://cloud.r-project.org\"))\n\nzones &lt;- spanishoddata::spod_get_zones(\"gau\", ver = 2)\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\ngau_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_GAU/zonificacion_gaus.shp\")\ngau_names_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_GAU/nombres_gaus.csv\")\n\nLoad the data and join the Large Urban Areas names to the boundaries.\n\ngau_boundaries &lt;- read_sf(gau_boundaries_data_file)\n\ngau_names &lt;- read_delim(gau_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ngau_boundaries &lt;- gau_boundaries |&gt;\n    left_join(gau_names |&gt; select(ID, name), by = c(\"ID\"))\n\n\nIdentify Invalid Geometries\n\n\ngau_boundaries_invalid &lt;- !st_is_valid(gau_boundaries)\n\n\n\nResults\n\nNumber of Invalid Geometries\n\n\nsum(gau_boundaries_invalid)\n\n[1] 3\n\n\n\nNames of Large Urban Areas with Invalid Geometries\n\n\nDT::datatable(gau_boundaries[gau_boundaries_invalid,] |&gt; st_drop_geometry())\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(gau_boundaries_data_file, gau_names_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/001-invalid-geoms-municipalities.html",
    "href": "issues/001-invalid-geoms-municipalities.html",
    "title": "Invalid Geometries in Municipality Boundaries",
    "section": "",
    "text": "Status: ✅ resolved\nImportance: 2 - medium\nSummary: There are 2 invalid geometries in the municipality boundaries dataset.\nExpected Results: The dataset should not contain any invalid geometries.\n\nResolution: resolved with https://github.com/Robinlovelace/spanishoddata/pull/25 in {spanishoddata} R package.\nTo get valid spatial data, use spanishoddata::spod_get_zones()\n\ninstall.packages(\"spanishoddata\",\n  repos = c(\"https://e-kotov.r-universe.dev\", \"https://cloud.r-project.org\"))\n\nzones &lt;- spanishoddata::spod_get_zones(\"municip\", ver = 2)\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\nmunicipal_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/zonificacion_municipios.shp\")\nmunicipality_names_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/nombres_municipios.csv\")\n\nLoad the data and join the municipality names to the boundaries.\n\nmunicipality_boundaries &lt;- read_sf(municipal_boundaries_data_file)\n\nmunicipality_names &lt;- read_delim(municipality_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nmunicipality_boundaries &lt;- municipality_boundaries |&gt;\n    left_join(municipality_names |&gt; select(ID, name), by = c(\"ID\"))\n\n\nIdentify Invalid Geometries\n\n\nmunicipality_boundaries_invalid &lt;- !st_is_valid(municipality_boundaries)\n\n\n\nResults\n\nNumber of Invalid Geometries\n\n\nsum(municipality_boundaries_invalid)\n\n[1] 2\n\n\n\nNames of Municipalities with Invalid Geometries\n\n\nDT::datatable(municipality_boundaries[municipality_boundaries_invalid,] |&gt; st_drop_geometry())\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(municipal_boundaries_data_file, municipality_names_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/006-missing-column-names-in-district-pop.html",
    "href": "issues/006-missing-column-names-in-district-pop.html",
    "title": "Missing column names in district population CSV",
    "section": "",
    "text": "Status: ✅ resolved\nImportance: 1 - low\nSummary: CSV file with district population data is missing column names.\nExpected Results: The dataset should have ID and population columns.\n\nResolution: resolved with https://github.com/Robinlovelace/spanishoddata/pull/25 in {spanishoddata} R package.\nTo get valid spatial data, use spanishoddata::spod_get_zones()\n\ninstall.packages(\"spanishoddata\",\n  repos = c(\"https://e-kotov.r-universe.dev\", \"https://cloud.r-project.org\"))\n\nzones &lt;- spanishoddata::spod_get_zones(\"dist\", ver = 2)\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(DT)\n\ndistrict_population_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/poblacion_distritos.csv\")\n\nLoad the data and join the district names to the boundaries.\n\ndistrict_population &lt;- read.delim(district_population_file, sep = \"|\")\n\n\n\nResults\n\nMissing column names\n\n\nnames(district_population)\n\n[1] \"X01001\"  \"X2925.0\"\n\nstr(district_population)\n\n'data.frame':   3791 obs. of  2 variables:\n $ X01001 : chr  \"01002\" \"01004_AM\" \"01009_AM\" \"01010\" ...\n $ X2925.0: num  10307 3005 4599 2951 4314 ...\n\n\n\nPreview of the district population table\n\n\nDT::datatable(district_population)\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(district_population_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/009-missing-population-counts-for-large-urban-ares.html",
    "href": "issues/009-missing-population-counts-for-large-urban-ares.html",
    "title": "Large Urban Areas population CSV missing population counts",
    "section": "",
    "text": "Status: ⚠️ active\nImportance: 1 - low\nSummary: The dataset contains missing population counts for XX Large Urban Areas in the CSV file poblacion_gaus.csv in the zonificacion_GAU folder, as well as in the poblacion.csv file in the zonificacion folder.\nExpected Results: The population data for all Large Urban Areas should be available in the CSV file poblacion_gaus.csv in the zonificacion_GAU folder and/or in the poblacion.csv file in the zonificacion folder.\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\ngau_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_GAU/zonificacion_gaus.shp\")\ngau_names_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_GAU/nombres_gaus.csv\")\ngau_population_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_GAU/poblacion_gaus.csv\")\nall_population_file &lt;- here(\"data/raw_data/v2/zonificacion/poblacion.csv\")\n\nLoad the data and join the district names to the boundaries, as well as population from all population file and districts population file.\n\ngau_boundaries &lt;- read_sf(gau_boundaries_data_file)\ngau_boundaries_spain_only &lt;- gau_boundaries |&gt; \n    filter(! grepl(\"FR|PT|externo\", ID) )\n\ngau_names &lt;- read_delim(gau_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ngau_population &lt;- read_delim(gau_population_file, col_names = c(\"ID\", \"population\"),\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nall_population &lt;- read_delim(all_population_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ngau_boundaries_spain_only &lt;- gau_boundaries_spain_only |&gt;\n    left_join(gau_names |&gt; select(ID, name), by = c(\"ID\")) |&gt; \n    left_join(gau_population, by = c(\"ID\")) |&gt; \n        left_join(all_population |&gt;\n                  group_by(distrito) |&gt;\n                  summarise(population_all = sum(poblacion, na.rm = TRUE), .groups = \"drop\") |&gt; \n                  rename(ID = distrito),\n              by = c(\"ID\"))\n\n\n\nResults\n\nMissing population (loaded from the poblacion_gaus.csv in zonificacion_GAU folder)\n\n\ngau_boundaries_spain_only |&gt;\n    filter(is.na(population)) |&gt;\n    nrow()\n\n[1] 49\n\n\n\nPopulation data for Large Urban Areas is also unavailable in the poblacion.csv in the zonificacion \n\nThere are no population counts for these districts in the poblacion.csv file either.\n\ngau_boundaries_spain_only |&gt;\n    filter(!is.na(population_all)) |&gt;\n    filter(population_all == 0) |&gt; \n    nrow()\n\n[1] 49\n\n\n\nNames of districts with missing population data\n\n\nDT::datatable(gau_boundaries_spain_only |&gt;\n                  st_drop_geometry() |&gt; \n                  filter(is.na(population))\n                  )\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(gau_boundaries_data_file, gau_names_file,\n                                              gau_population_file, all_population_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/003-missing-population-counts-for-municipalities.html",
    "href": "issues/003-missing-population-counts-for-municipalities.html",
    "title": "Municipal population CSV missing population counts",
    "section": "",
    "text": "Status: ⚠️ active\nImportance: 1 - low\nSummary: The dataset contains missing population counts for 49 municipalities in the CSV file poblacion_municipios.csv in the zonificacion_municipios folder, as well as in the poblacion.csv file in the zonificacion folder.\nExpected Results: The population data for all municipalities should be available in the CSV file poblacion_municipios.csv in the zonificacion_municipios folder and/or in the poblacion.csv file in the zonificacion folder.\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\nmunicipal_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/zonificacion_municipios.shp\")\nmunicipality_names_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/nombres_municipios.csv\")\nmunicipality_population_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/poblacion_municipios.csv\")\nall_population_file &lt;- here(\"data/raw_data/v2/zonificacion/poblacion.csv\")\n\nLoad the data and join the municipality names to the boundaries, as well as population from all population file and municipality population file.\n\nmunicipality_boundaries &lt;- read_sf(municipal_boundaries_data_file)\nmunicipality_boundaries_spain_only &lt;- municipality_boundaries |&gt; \n    filter(! grepl(\"FR|PT|externo\", ID) )\n\nmunicipality_names &lt;- read_delim(municipality_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nmunicipality_population &lt;- read_delim(municipality_population_file, col_names = c(\"ID\", \"population\"),\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nall_population &lt;- read_delim(all_population_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nmunicipality_boundaries_spain_only &lt;- municipality_boundaries_spain_only |&gt;\n    left_join(municipality_names |&gt; select(ID, name), by = c(\"ID\")) |&gt; \n    left_join(municipality_population, by = c(\"ID\")) |&gt; \n    left_join(all_population |&gt;\n                  group_by(municipio) |&gt;\n                  summarise(population_all = sum(poblacion, na.rm = TRUE), .groups = \"drop\") |&gt; \n                  rename(ID = municipio),\n              by = c(\"ID\"))\n\n\n\nResults\n\nMissing population (loaded from the poblacion_municipios.csv in zonificacion_municipios folder)\n\n\nmunicipality_boundaries_spain_only |&gt;\n    filter(is.na(population)) |&gt;\n    nrow()\n\n[1] 49\n\n\n\nPopulation data for municipalities also unavailable in the poblacion.csv in the zonificacion \n\nThere are no population counts for these districts in the poblacion.csv file either.\n\nmunicipality_boundaries_spain_only |&gt;\n    filter(!is.na(population_all)) |&gt;\n    filter(population_all == 0) |&gt; \n    nrow()\n\n[1] 49\n\n\n\nNames of Municipalities with missing population data\n\n\nDT::datatable(municipality_boundaries_spain_only |&gt;\n                  st_drop_geometry() |&gt; \n                  filter(is.na(population))\n                  )\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(municipal_boundaries_data_file, municipality_names_file,\n                                              municipality_population_file, all_population_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Issues in MITMA open mobility data",
    "section": "",
    "text": "This is a collection of issues identified (and resolved, if applicable) in the MITMA open mobility data.\nThe identified issues are being gradually resolved in the {spanishoddata} R package (currently work in progress).\nThe data in this repository contains “datos abiertos MITMA” (“MITMA open data”) (Secretaría de Estado de Infraestructuras, Transporte y Vivienda (Secretariat of State for Infrastructure, Transport, and Housing) 2024) downloaded from this page.\nFull data license is available here.\nThis repository can be opened in a web browser using Binder to explore all issues (under issues subfolder) interactively with R/Rstudio. Push the button &gt;&gt;",
    "crumbs": [
      "Issues in MITMA open mobility data"
    ]
  },
  {
    "objectID": "index.html#active-issues",
    "href": "index.html#active-issues",
    "title": "Issues in MITMA open mobility data",
    "section": "Active Issues",
    "text": "Active Issues\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Modified - Oldest\n        \n         \n          Modified - Newest\n        \n         \n          issue-importance\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\nDate\n\n\nModified\n\n\nTitle\n\n\nCategories\n\n\nissue-importance\n\n\n\n\n\n\n2024-08-17\n\n\n2024-08-17\n\n\nMismatch of zone ids in spatial data and trips per person table for municipal zoning\n\n\ntabular data, incorrect data, zone IDs mismatch, importance: high\n\n\n3 - high\n\n\n\n\n2024-07-16\n\n\n2024-08-17\n\n\nDistrict zone IDs in municipal overnight stays data\n\n\ntabular data, incorrect data, zone IDs mismatch, importance: high\n\n\n2 - medium\n\n\n\n\n2024-07-16\n\n\n2024-07-16\n\n\nMunicipal population CSV missing population counts\n\n\ntabular data, missing data, importance: low\n\n\n1 - low\n\n\n\n\n2024-07-16\n\n\n2024-07-17\n\n\nDistrict population CSV missing population counts\n\n\ntabular data, missing data, importance: low\n\n\n1 - low\n\n\n\n\n2024-07-16\n\n\n2024-07-17\n\n\nLarge Urban Areas population CSV missing population counts\n\n\ntabular data, missing data, importance: low\n\n\n1 - low\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "Issues in MITMA open mobility data"
    ]
  },
  {
    "objectID": "index.html#resolved-issues",
    "href": "index.html#resolved-issues",
    "title": "Issues in MITMA open mobility data",
    "section": "Resolved Issues",
    "text": "Resolved Issues\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Modified - Oldest\n        \n         \n          Modified - Newest\n        \n         \n          issue-importance\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\nDate\n\n\nModified\n\n\nTitle\n\n\nCategories\n\n\nissue-importance\n\n\n\n\n\n\n2024-07-16\n\n\n2024-08-17\n\n\nInvalid Geometries in Municipality Boundaries\n\n\nspatial data, geometry, importance: medium\n\n\n2 - medium\n\n\n\n\n2024-07-17\n\n\n2024-08-17\n\n\nInvalid Geometries in District Boundaries\n\n\nspatial data, geometry, importance: medium\n\n\n2 - medium\n\n\n\n\n2024-07-17\n\n\n2024-08-17\n\n\nInvalid Geometries in Large Urban Areas Boundaries\n\n\nspatial data, geometry, importance: medium\n\n\n2 - medium\n\n\n\n\n2024-07-17\n\n\n2024-08-17\n\n\nMissing column names in municipal population CSV\n\n\ntabular data, metadata, importance: low\n\n\n1 - low\n\n\n\n\n2024-07-17\n\n\n2024-08-17\n\n\nMissing column names in district population CSV\n\n\ntabular data, metadata, importance: low\n\n\n1 - low\n\n\n\n\n2024-07-17\n\n\n2024-08-17\n\n\nMissing column names in Large Urban Areas population CSV\n\n\ntabular data, metadata, importance: low\n\n\n1 - low\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "Issues in MITMA open mobility data"
    ]
  },
  {
    "objectID": "license.html",
    "href": "license.html",
    "title": "License",
    "section": "",
    "text": "https://movilidad-opendata.mitma.es/LICENCIA%20de%20datos%20abiertos%20del%20MITMA%2020201203.pdf.",
    "crumbs": [
      "License"
    ]
  },
  {
    "objectID": "license.html#original-data-license",
    "href": "license.html#original-data-license",
    "title": "License",
    "section": "",
    "text": "https://movilidad-opendata.mitma.es/LICENCIA%20de%20datos%20abiertos%20del%20MITMA%2020201203.pdf.",
    "crumbs": [
      "License"
    ]
  },
  {
    "objectID": "license.html#this-reposite-license",
    "href": "license.html#this-reposite-license",
    "title": "License",
    "section": "This repo/site license",
    "text": "This repo/site license\nCreative Commons Legal Code\nCC0 1.0 Universal\nCREATIVE COMMONS CORPORATION IS NOT A LAW FIRM AND DOES NOT PROVIDE\nLEGAL SERVICES. DISTRIBUTION OF THIS DOCUMENT DOES NOT CREATE AN\nATTORNEY-CLIENT RELATIONSHIP. CREATIVE COMMONS PROVIDES THIS\nINFORMATION ON AN \"AS-IS\" BASIS. CREATIVE COMMONS MAKES NO WARRANTIES\nREGARDING THE USE OF THIS DOCUMENT OR THE INFORMATION OR WORKS\nPROVIDED HEREUNDER, AND DISCLAIMS LIABILITY FOR DAMAGES RESULTING FROM\nTHE USE OF THIS DOCUMENT OR THE INFORMATION OR WORKS PROVIDED\nHEREUNDER.\nStatement of Purpose\nThe laws of most jurisdictions throughout the world automatically confer exclusive Copyright and Related Rights (defined below) upon the creator and subsequent owner(s) (each and all, an “owner”) of an original work of authorship and/or a database (each, a “Work”).\nCertain owners wish to permanently relinquish those rights to a Work for the purpose of contributing to a commons of creative, cultural and scientific works (“Commons”) that the public can reliably and without fear of later claims of infringement build upon, modify, incorporate in other works, reuse and redistribute as freely as possible in any form whatsoever and for any purposes, including without limitation commercial purposes. These owners may contribute to the Commons to promote the ideal of a free culture and the further production of creative, cultural and scientific works, or to gain reputation or greater distribution for their Work in part through the use and efforts of others.\nFor these and/or other purposes and motivations, and without any expectation of additional consideration or compensation, the person associating CC0 with a Work (the “Affirmer”), to the extent that he or she is an owner of Copyright and Related Rights in the Work, voluntarily elects to apply CC0 to the Work and publicly distribute the Work under its terms, with knowledge of his or her Copyright and Related Rights in the Work and the meaning and intended legal effect of CC0 on those rights.\n\nCopyright and Related Rights. A Work made available under CC0 may be protected by copyright and related or neighboring rights (“Copyright and Related Rights”). Copyright and Related Rights include, but are not limited to, the following:\n\n\nthe right to reproduce, adapt, distribute, perform, display, communicate, and translate a Work;\nmoral rights retained by the original author(s) and/or performer(s);\npublicity and privacy rights pertaining to a person’s image or likeness depicted in a Work;\nrights protecting against unfair competition in regards to a Work, subject to the limitations in paragraph 4(a), below;\nrights protecting the extraction, dissemination, use and reuse of data in a Work;\ndatabase rights (such as those arising under Directive 96/9/EC of the European Parliament and of the Council of 11 March 1996 on the legal protection of databases, and under any national implementation thereof, including any amended or successor version of such directive); and\nother similar, equivalent or corresponding rights throughout the world based on applicable law or treaty, and any national implementations thereof.\n\n\nWaiver. To the greatest extent permitted by, but not in contravention of, applicable law, Affirmer hereby overtly, fully, permanently, irrevocably and unconditionally waives, abandons, and surrenders all of Affirmer’s Copyright and Related Rights and associated claims and causes of action, whether now known or unknown (including existing as well as future claims and causes of action), in the Work (i) in all territories worldwide, (ii) for the maximum duration provided by applicable law or treaty (including future time extensions), (iii) in any current or future medium and for any number of copies, and (iv) for any purpose whatsoever, including without limitation commercial, advertising or promotional purposes (the “Waiver”). Affirmer makes the Waiver for the benefit of each member of the public at large and to the detriment of Affirmer’s heirs and successors, fully intending that such Waiver shall not be subject to revocation, rescission, cancellation, termination, or any other legal or equitable action to disrupt the quiet enjoyment of the Work by the public as contemplated by Affirmer’s express Statement of Purpose.\nPublic License Fallback. Should any part of the Waiver for any reason be judged legally invalid or ineffective under applicable law, then the Waiver shall be preserved to the maximum extent permitted taking into account Affirmer’s express Statement of Purpose. In addition, to the extent the Waiver is so judged Affirmer hereby grants to each affected person a royalty-free, non transferable, non sublicensable, non exclusive, irrevocable and unconditional license to exercise Affirmer’s Copyright and Related Rights in the Work (i) in all territories worldwide, (ii) for the maximum duration provided by applicable law or treaty (including future time extensions), (iii) in any current or future medium and for any number of copies, and (iv) for any purpose whatsoever, including without limitation commercial, advertising or promotional purposes (the “License”). The License shall be deemed effective as of the date CC0 was applied by Affirmer to the Work. Should any part of the License for any reason be judged legally invalid or ineffective under applicable law, such partial invalidity or ineffectiveness shall not invalidate the remainder of the License, and in such case Affirmer hereby affirms that he or she will not (i) exercise any of his or her remaining Copyright and Related Rights in the Work or (ii) assert any associated claims and causes of action with respect to the Work, in either case contrary to Affirmer’s express Statement of Purpose.\nLimitations and Disclaimers.\n\n\nNo trademark or patent rights held by Affirmer are waived, abandoned, surrendered, licensed or otherwise affected by this document.\nAffirmer offers the Work as-is and makes no representations or warranties of any kind concerning the Work, express, implied, statutory or otherwise, including without limitation warranties of title, merchantability, fitness for a particular purpose, non infringement, or the absence of latent or other defects, accuracy, or the present or absence of errors, whether or not discoverable, all to the greatest extent permissible under applicable law.\nAffirmer disclaims responsibility for clearing rights of other persons that may apply to the Work or any use thereof, including without limitation any person’s Copyright and Related Rights in the Work. Further, Affirmer disclaims responsibility for obtaining any necessary consents, permissions or other rights required for any use of the Work.\nAffirmer understands and acknowledges that Creative Commons is not a party to this document and has no duty or obligation with respect to this CC0 or use of the Work.",
    "crumbs": [
      "License"
    ]
  },
  {
    "objectID": "issues/008-missing-population-counts-for-districts.html",
    "href": "issues/008-missing-population-counts-for-districts.html",
    "title": "District population CSV missing population counts",
    "section": "",
    "text": "Status: ⚠️ active\nImportance: 1 - low\nSummary: The dataset contains missing population counts for 49 districts in the CSV file poblacion_distritos.csv in the zonificacion_distritos folder, as well as in the poblacion.csv file in the zonificacion folder.\nExpected Results: The population data for all districts should be available in the CSV file poblacion_distritos.csv in the zonificacion_distritos folder and/or in the poblacion.csv file in the zonificacion folder.\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\ndistrict_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/zonificacion_distritos.shp\")\ndistrict_names_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/nombres_distritos.csv\")\ndistrict_population_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/poblacion_distritos.csv\")\nall_population_file &lt;- here(\"data/raw_data/v2/zonificacion/poblacion.csv\")\n\nLoad the data and join the district names to the boundaries, as well as population from all population file and districts population file.\n\ndistrict_boundaries &lt;- read_sf(district_boundaries_data_file)\ndistrict_boundaries_spain_only &lt;- district_boundaries |&gt; \n    filter(! grepl(\"FR|PT|externo\", ID) )\n\ndistrict_names &lt;- read_delim(district_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ndistrict_population &lt;- read_delim(district_population_file, col_names = c(\"ID\", \"population\"),\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\nall_population &lt;- read_delim(all_population_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ndistrict_boundaries_spain_only &lt;- district_boundaries_spain_only |&gt;\n    left_join(district_names |&gt; select(ID, name), by = c(\"ID\")) |&gt; \n    left_join(district_population, by = c(\"ID\")) |&gt; \n    left_join(all_population |&gt;\n                  group_by(distrito) |&gt;\n                  summarise(population_all = sum(poblacion, na.rm = TRUE), .groups = \"drop\") |&gt; \n                  rename(ID = distrito),\n              by = c(\"ID\"))\n\n\n\nResults\n\nMissing population (loaded from the poblacion_distritos.csv in zonificacion_distritos folder)\n\n\ndistrict_boundaries_spain_only |&gt;\n    filter(is.na(population)) |&gt;\n    nrow()\n\n[1] 49\n\n\n\nPopulation data for districts also unavailable in the poblacion.csv in the zonificacion \n\nThere are no population counts for these districts in the poblacion.csv file either.\n\ndistrict_boundaries_spain_only |&gt;\n    filter(!is.na(population_all)) |&gt;\n    filter(population_all == 0) |&gt; \n    nrow()\n\n[1] 49\n\n\n\nNames of districts with missing population data\n\n\nDT::datatable(district_boundaries_spain_only |&gt;\n                  st_drop_geometry() |&gt; \n                  filter(is.na(population))\n                  )\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(district_boundaries_data_file, district_names_file,\n                                              district_population_file, all_population_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/002-missing-column-names-in-municip-pop.html",
    "href": "issues/002-missing-column-names-in-municip-pop.html",
    "title": "Missing column names in municipal population CSV",
    "section": "",
    "text": "Status: ✅ resolved\nImportance: 1 - low\nSummary: CSV file with municipal population data is missing column names.\nExpected Results: The dataset should have ID and population columns.\n\nResolution: resolved with https://github.com/Robinlovelace/spanishoddata/pull/25 in {spanishoddata} R package.\nTo get valid spatial data, use spanishoddata::spod_get_zones()\n\ninstall.packages(\"spanishoddata\",\n  repos = c(\"https://e-kotov.r-universe.dev\", \"https://cloud.r-project.org\"))\n\nzones &lt;- spanishoddata::spod_get_zones(\"municip\", ver = 2)\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(DT)\n\nmunicipality_population_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/poblacion_municipios.csv\")\n\nLoad the data and join the municipality names to the boundaries.\n\nmunicipality_population &lt;- read.delim(municipality_population_file, sep = \"|\")\n\n\n\nResults\n\nMissing column names\n\n\nnames(municipality_population)\n\n[1] \"X01001\"  \"X2925.0\"\n\nstr(municipality_population)\n\n'data.frame':   2617 obs. of  2 variables:\n $ X01001 : chr  \"01002\" \"01004_AM\" \"01009_AM\" \"01010\" ...\n $ X2925.0: num  10307 3005 4599 2951 4314 ...\n\n\n\nPreview of the municipal population table\n\n\nDT::datatable(municipality_population)\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(municipality_population_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/007-missing-column-names-for-large-urban-areas.html",
    "href": "issues/007-missing-column-names-for-large-urban-areas.html",
    "title": "Missing column names in Large Urban Areas population CSV",
    "section": "",
    "text": "Status: ✅ resolved\nImportance: 1 - low\nSummary: CSV file with Large Urban Areas population data is missing column names.\nExpected Results: The dataset should have ID and population columns.\n\nResolution: resolved with https://github.com/Robinlovelace/spanishoddata/pull/25 in {spanishoddata} R package.\nTo get valid spatial data, use spanishoddata::spod_get_zones()\n\ninstall.packages(\"spanishoddata\",\n  repos = c(\"https://e-kotov.r-universe.dev\", \"https://cloud.r-project.org\"))\n\nzones &lt;- spanishoddata::spod_get_zones(\"gau\", ver = 2)\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(DT)\n\ngau_population_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_GAU/poblacion_gaus.csv\")\n\nLoad the data and join the Large Urban Areas names to the boundaries.\n\ngau_population &lt;- read.delim(gau_population_file, sep = \"|\")\n\n\n\nResults\n\nMissing column names\n\n\nnames(gau_population)\n\n[1] \"X01001\"  \"X2925.0\"\n\nstr(gau_population)\n\n'data.frame':   2085 obs. of  2 variables:\n $ X01001 : chr  \"01002\" \"01004_AM\" \"01009_AM\" \"01010\" ...\n $ X2925.0: num  10307 3005 4599 2951 4314 ...\n\n\n\nPreview of the Large Urban Areas population table\n\n\nDT::datatable(gau_population)\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(gau_population_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/004-invalid-geoms-districts.html",
    "href": "issues/004-invalid-geoms-districts.html",
    "title": "Invalid Geometries in District Boundaries",
    "section": "",
    "text": "Status: ✅ resolved\nImportance: 2 - medium\nSummary: There are 3 invalid geometries in the census districts boundaries dataset.\nExpected Results: The dataset should not contain any invalid geometries.\n\nResolution: resolved with https://github.com/Robinlovelace/spanishoddata/pull/25 in {spanishoddata} R package.\nTo get valid spatial data, use spanishoddata::spod_get_zones()\n\ninstall.packages(\"spanishoddata\",\n  repos = c(\"https://e-kotov.r-universe.dev\", \"https://cloud.r-project.org\"))\n\nzones &lt;- spanishoddata::spod_get_zones(\"distr\", ver = 2)\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\ndistrict_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/zonificacion_distritos.shp\")\ndistrict_names_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/nombres_distritos.csv\")\n\nLoad the data and join the district names to the boundaries.\n\ndistrict_boundaries &lt;- read_sf(district_boundaries_data_file)\n\ndistrict_names &lt;- read_delim(district_names_file,\n    delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n\ndistrict_boundaries &lt;- district_boundaries |&gt;\n    left_join(district_names |&gt; select(ID, name), by = c(\"ID\"))\n\n\nIdentify Invalid Geometries\n\n\ndistrict_boundaries_invalid &lt;- !st_is_valid(district_boundaries)\n\n\n\nResults\n\nNumber of Invalid Geometries\n\n\nsum(district_boundaries_invalid)\n\n[1] 3\n\n\n\nNames of Districts with Invalid Geometries\n\n\nDT::datatable(district_boundaries[district_boundaries_invalid,] |&gt; st_drop_geometry())\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(district_boundaries_data_file, district_names_file)) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  },
  {
    "objectID": "issues/010-incorrect-zone-ids-in-municipal-overnight-stays.html",
    "href": "issues/010-incorrect-zone-ids-in-municipal-overnight-stays.html",
    "title": "District zone IDs in municipal overnight stays data",
    "section": "",
    "text": "Status: ⚠️ active\nImportance: 2 - medium\nNote: According to the official methodology this is by design. However, still needs to be addressed in workflows within the {spanishoddata} R package.\nSummary: The zone IDs in the municipal overnight stays data are not consistent with the zone IDs in the municipal boundaries data. The zone IDs in the municipal overnight stays data for the residential location column zona_residencia are a combination of district and municipal IDs.\nExpected Results: The zone IDs in the municipal overnight stays data should be consistent with the zone IDs in the municipal boundaries data (unless the use of district IDs in the residential location column zona_residencia is intentional).\n\n\n\nSteps to Reproduce\n\nLoad Data\n\nLoad libraries and define data files.\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(here)\nlibrary(DT)\n\n\novernight_stays_file &lt;- here(\"data/raw_data/v2/estudios_basicos/por-municipios/pernoctaciones/ficheros-diarios/2022-01/20220101_Pernoctaciones_municipios.csv.gz\")\nmunicipal_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_municipios/zonificacion_municipios.shp\")\ndistrict_boundaries_data_file &lt;- here(\"data/raw_data/v2/zonificacion/zonificacion_distritos/zonificacion_distritos.shp\")\n\nLoad the data.\n\novernight_stays &lt;- readr::read_delim(overnight_stays_file, delim = \"|\", show_col_types = FALSE, name_repair = \"unique_quiet\")\n# municipal_boundaries &lt;- read_sf(municipal_boundaries_data_file) |&gt; filter(!grepl(\"PT|FR|externo\", ID))\n# district_boundaries &lt;- read_sf(district_boundaries_data_file) |&gt; filter(!grepl(\"PT|FR|externo\", ID))\nmunicipal_boundaries &lt;- read_sf(municipal_boundaries_data_file)\ndistrict_boundaries &lt;- read_sf(district_boundaries_data_file)\n\n\nglimpse(overnight_stays)\n\nRows: 515,748\nColumns: 4\n$ fecha             &lt;dbl&gt; 20220101, 20220101, 20220101, 20220101, 20220101, 20…\n$ zona_residencia   &lt;chr&gt; \"01001\", \"01001\", \"01001\", \"01001\", \"01001\", \"01001\"…\n$ zona_pernoctacion &lt;chr&gt; \"01001\", \"01017_AM\", \"01047_AM\", \"01051\", \"01059\", \"…\n$ personas          &lt;dbl&gt; 2447.613, 9.000, 2.514, 5.780, 181.970, 3.266, 3.266…\n\nglimpse(municipal_boundaries)\n\nRows: 2,735\nColumns: 2\n$ ID       &lt;chr&gt; \"01001\", \"01002\", \"01004_AM\", \"01009_AM\", \"01010\", \"01017_AM\"…\n$ geometry &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((537856.7 47..., MULTIPOLYGON (((…\n\nglimpse(district_boundaries)\n\nRows: 3,909\nColumns: 2\n$ ID       &lt;chr&gt; \"01001\", \"01002\", \"01004_AM\", \"01009_AM\", \"01010\", \"01017_AM\"…\n$ geometry &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((538090.2 47..., MULTIPOLYGON (((…\n\n\n\n\nResults\n\nNot all residence location IDs in the municipal level overnight stays dataset can be found in the municipal boundaries dataset.\n\nNot all residence location (zona_residencia) IDs in the municipal level overnight stays dataset can be found in the municipal boundaries dataset. Residence locations in municipal level overnight stays uses district IDs in addition to municipal IDs. That is, just using the municipal boundaries dataset is not enough to match all the residence locations in the overnight stays dataset.\n\nsum(!unique(overnight_stays$zona_residencia) %in% unique(municipal_boundaries$ID))\n\n[1] 1596\n\n\nMeanwhile, all residence location (zona_residencia) IDs in the municipal level overnight stays can be found in the district boundaries dataset.\n\nsum(!unique(overnight_stays$zona_residencia) %in% unique(district_boundaries$ID))\n\n[1] 0\n\n\nOnly municipal IDs are used in the zona_pernoctacion column of the overnight stays dataset.\n\nsum(!unique(overnight_stays$zona_pernoctacion) %in% unique(municipal_boundaries$ID))\n\n[1] 0\n\n\n\nSample of rows with residence location IDs coming from district breakdown in the municipal boundaries overnight stays\n\n\nDT::datatable(overnight_stays |&gt; filter(!zona_residencia %in% unique(municipal_boundaries$ID)) |&gt; sample_n(100))\n\n\n\n\n\n\n\nLinks to the original files\n\nsource(here(\"R/901-download-helpers.R\"))\nfiles &lt;- load_latest_v2_xml()\n\n# Filter relevant files\nrelevant_files &lt;- files |&gt; \n  filter(basename(local_path) %in% basename(c(\n    overnight_stays_file,\n    municipal_boundaries_data_file,\n    district_boundaries_data_file\n  )) )\n\n# Create HTML links\nrelevant_files &lt;- relevant_files |&gt; \n  mutate(target_url = paste0(\"&lt;a href='\", target_url, \"' target='_blank'&gt;\", target_url, \"&lt;/a&gt;\"))\n\n# Render the DT table with links\ndatatable(relevant_files, escape = FALSE, options = list(pageLength = 5))"
  }
]